# This is the standard config file for running with two
# CMS Pixel DTB chips (DUT and REF planes)

[Producer.TLU]
# scint: 4 3 2 1 <--- beam
# 
# scint bits     2+4 =  6
# scint bits     4+8 = 12
# scint bits   1+4+8 = 13
# scint bits   2+4+8 = 14
# scint bits 1+2+4+8 = 15
AndMask = 13
OrMask = 0
VetoMask = 0
DutMask = 9
DebugLevel = 10
TriggerInterval = 0
TrigRollover = 0
# Setting HandShakeMode to 1: activate Handshake only for channel 0 (bit 1) 
# which is the telescope. The TLU does not expect a BUSY from CMSPixel
HandShakeMode = 1
#HandShakeMode = 9
EnableDUTVeto = 0
DUTInput3 = LEMO

#------------------------------------------------------------------------------
[Producer.CMSPixel]

# DUT SAMPLE CHIP: 239, 205, 202
#roctype = psi46dig

# DUT SAMPLE CHIP: 308, 309
#roctype = psi46digv2

# DUT SAMPLE CHIP: 401
#roctype = psi46digv21

# DUT SAMPLE CHIP: 504, 505, 506rot
roctype = psi46digv21respin

#DUTsamplechip 110
#roctype = psi46v2

# PCB type
# Use "desytb" for the regular PCBs (ROC cols in x, rows in y)
pcbtype = desytb
# USe "desytb-rot" for the rotated PCB (ROC rows in x, cols in y)
#pcbtype = desy-rot

#trimFile = "/home/cmspixel/configurations/chip504/trimParameters_c504_ia24-trim30-Feb.dat"
#dacFile = "/home/cmspixel/configurations/chip504/dacParameters_c504_ia24-trim28.dat"
#trimFile = "/home/cmspixel/configurations/chip504/trimParameters_c504_ia24-trim28.dat"
#dacFile = "/home/cmspixel/configurations/chip504/dacParameters_c504_vd6-ia24-trim32-chiller15.dat"
#trimFile = "/home/cmspixel/configurations/chip504/trimParameters_c504_vd6-ia24-trim32-chiller15.dat"
dacFile = "/home/cmspixel/configurations/chip504/dacParameters_c504_ia24-trim36tb-chiller17.dat"
trimFile = "/home/cmspixel/configurations/chip504/trimParameters_c504_ia24-trim36tb-chiller17.dat"

#dacFile = "/home/cmspixel/configurations/chip110/dacParameters65_C0.dat"
#trimFile = "/home/cmspixel/configurations/chip110/trimParameters65_C0.dat"

#dacFile = "/home/cmspixel/configurations/chip506/dacParameters_c506_ia24-trim28.dat"
#trimFile = "/home/cmspixel/configurations/chip506/trimParameters_c506_ia24-trim28.dat"
#dacFile = "/home/cmspixel/configurations/chip506/dacParameters_c506_ia24-trim32.dat"
#trimFile = "/home/cmspixel/configurations/chip506/trimParameters_c506_ia24-trim32.dat"

#dacFile = "/home/cmspixel/configurations/chip239/dacParameters_c239_ia27-vd6-trim40.dat"
#trimFile = "/home/cmspixel/configurations/chip239/trimParameters_c239_ia27-vd6-trim40.dat"
#dacFile = "/home/cmspixel/configurations/chip239/dacParameters_c239_ia27-vd6-cold-trim36.dat"
#trimFile = "/home/cmspixel/configurations/chip239/trimParameters_c239_ia27-vd6-cold-trim36.dat"

#dacFile = "/home/cmspixel/configurations/chip205/dacParameters_c205_ia27-cold-trim40.dat"
#trimFile = "/home/cmspixel/configurations/chip205/trimParameters_c205_ia27-cold-trim40.dat"
#dacFile = "/home/cmspixel/configurations/chip205/dacParameters_c205_ia27-vd5-cold-trim40.dat"
#trimFile = "/home/cmspixel/configurations/chip205/trimParameters_c205_ia27-vd5-cold-trim40.dat"

#dacFile = "/home/cmspixel/configurations/chip202/dacParameters_c202i_warm-ia27-trim40.dat"
#trimFile = "/home/cmspixel/configurations/chip202/trimParameters_c202i_warm-ia27-trim40.dat"

#dacFile = "/home/cmspixel/configurations/chip309/dacParameters_c309_ia27-trim40.dat"
#trimFile = "/home/cmspixel/configurations/chip309/trimParameters_c309_ia27-trim40.dat"

#dacFile = "/home/cmspixel/configurations/chip308/dacParameters_c308_ia28-trim38.dat"
#trimFile = "/home/cmspixel/configurations/chip308/trimParameters_c308_ia28-trim38.dat"

#dacFile = "/home/cmspixel/configurations/chip401/dacParameters_c401_ia27-trim36.dat"
#trimFile = "/home/cmspixel/configurations/chip401/trimParameters_c401_ia27-trim36.dat"

#dacFile = "/home/cmspixel/configurations/chip505/dacParameters_c505_ia24-trim36.dat"
#trimFile = "/home/cmspixel/configurations/chip505/trimParameters_c505_ia24-trim36.dat"

# DAC settings to overwrite DAC file values:

# Setting high vicolor seems to improve cluster distribution @ high tilt angles:
vicolor = 255 # for 506 at large column tilt
#vicolor = 50 # PSI

vibias_bus = 90 # for 506 edge, better

#wbc = 142 # with latency 86 for analog chip 110
wbc = 141 # with latency 86 for all chips except 400s
#wbc = 140 # with latency 86 for chip 401

#triggerlatency = 86 # historic default (from ATB)
#riggerlatency = 88 # ZEUS delay box
triggerlatency = 87 # dual-gate HP pulser

# Sending periodic ROC resets:
# Parameter to be given in milliseconds, setting 0 turns it off
#rocresetperiod = 50 # loose triggers

# DTB related settings:
# external clock on/off
external_clock = 1
# Select trigger source ("async" for external trigger):
trigger_source = async
# DTB board USB ID
usbId = "DTB_WS6MP2"
hubid = 31;

# Settings for analog ROC chip110
#tindelay = 14
#toutdelay = 8

# Scope outputs:
signalprobe_d1 = ctr
signalprobe_d2 = tout

# Supply voltages and current limits:
vd = 2.600 # default
va = 1.800
#va = 2.000 # for 205i
id = .200
ia = .100

# DTB Timing for analog:
#clk = 18
#ctr = 18
#sda = 33
#tin = 24
clk = 1
ctr = 1
sda = 16
tin = 6
deser160phase = 4
#level = 10
level = 12 # for 309

# Other settings (producer & pxarCore)
# pxarCore library verbosity
#verbosity = DEBUGPIPES
verbosity = INFO
# outputFile pattern
outputFilePath = "../data/DUT/"
# Waiting time (ms) before stopping DAQ (TLU is slow in stopping triggering...)
tlu_waiting_time = 4000

# Pattern generator
# turn on/off additional test pulses
testpulses = 0
# delays (BC) after this signal:
resetroc     = 25
calibrate    = 106
trigger      = 46
token        = 0
# delay between pattern loop:
patternDelay = 50000

#------------------------------------------------------------------------------
[Producer.CMSPixelREF]
# REFERENCE CHIP: 404
#roctype = psi46digv21

# REFERENCE CHIP: 501
#roctype = psi46digv21repsin
roctype = psi46digv21respin

pcbtype = desytb
#trimFile = "/home/cmspixel/configurations/chip404/trimParameters_c404_ia27-trim30.dat"
#dacFile = "/home/cmspixel/configurations/chip404/dacParameters_c404_ia27-trim30.dat"

trimFile = "/home/cmspixel/configurations/chip501/trimParameters_c501_ia24-trim30.dat"
dacFile = "/home/cmspixel/configurations/chip501/dacParameters_c501_ia24-trim30.dat"

# DAC settings overwriting DAC file values:
#wbc        = 140 # for 404
wbc        = 141 # for 501, 506
#triggerlatency = 88
triggerlatency = 87 # dual-gate HP pulser

# DTB related settings:
# external clock on/off
external_clock = 1
# Select trigger source ("async" for external trigger):
trigger_source = async
# DTB board USB ID:
#usbId = "DTB_WS6C22"
#usbId = "DTB_WS6MP2"
usbId = "DTB_WS8ZAW"
hubid = 31;

# Scope outputs:
signalprobe_d1 = ctr
signalprobe_d2 = tout

# Supply voltages and current limits:
vd = 2.500
va = 1.800
id = .100
ia = .100

# DTB Timing
clk = 1
ctr = 1
sda = 16
tin = 6
deser160phase = 4
level = 15

# Other settings (producer & pxarCore)
# pxarCore library verbosity
verbosity = WARNING
# outputFile pattern
outputFilePath = "../data/REF/"
# Waiting time (ms) before stopping DAQ (TLU is slow in stopping triggering...)
tlu_waiting_time = 4000

# Pattern generator
# turn on/off additional test pulses
testpulses = 0
# delays (BC) after this signal:
resetroc     = 25
calibrate    = 106
trigger      = 46
token        = 0
# delay between pattern loop:
patternDelay = 50000

#------------------------------------------------------------------------------
[Producer.MimosaNI]
NiIPaddr = 192.168.3.2
#NiDataTransportSocketPort = 49999
#NiConfigSocketPort = 49888
TriggerType = 1
Det = MIMOSA26
Mode = ZS2
NiVersion = 1
NumBoards = 6
FPGADownload = 1
OneFrame = 0
IDOffset = 0
MimosaID_1 = 11
MimosaID_2 = 12
MimosaID_3 = 19
MimosaID_4 = 4
MimosaID_5 = 2
MimosaID_6 = 20
MimosaEn_1 = 1
MimosaEn_2 = 1
MimosaEn_3 = 1
MimosaEn_4 = 1
MimosaEn_5 = 1
MimosaEn_6 = 1

[RunControl]
#RunSizeLimit = 500100200
RunEventLimit = 520100

[DataCollector]
FilePattern = "../data/run$6R$X"

[LogCollector]
SaveLevel = EXTRA
PrintLevel = INFO
